---
/**
 * ğŸ”’ FROZEN COMPONENT - DO NOT MODIFY STRUCTURE OR TEXT CONTENT
 * Owner: Yves
 * Only allowed changes:
 * 1) move hardcoded text into i18n messages (zh-TW first)
 * 2) replace inline links with LINKS from src/config/links.ts
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import { computeCanonical } from '@/utils/head';
import HeroTextAnimated from '@/components/HeroTextAnimated.astro';
import RedPacketAnimation from '@/islands/RedPacketAnimation';
import Section from '@/components/Section.astro';
import Brandify from '@/components/Brandify.astro';
import { brandify } from '@/lib/brandify';
import { getLocalesForBuild, defaultLocale } from '@/i18n/locales.config';
import { LOCALE_ORDER } from '@/config/locales';
import { CTA_LINKS } from '@/config/app';
import { externals as links } from '@/config/links';
import { linesArray } from '@/utils/normalize';

export async function getStaticPaths() {
  const locales = getLocalesForBuild();
  return locales.map((l) => ({ params: { lang: l.code } }));
}

const { lang } = Astro.params as { lang: string };
const messages = await import(`@/i18n/loadMessages`).then(m => m.loadAllMessages(lang as any)).catch(async () => {
  const fallback = await import(`@/i18n/loadMessages`).then(m => m.loadAllMessages(defaultLocale));
  return fallback;
});

// å®Œæ•´æ€§æª¢æŸ¥ï¼šè¨ˆç®—é æœŸæ®µè½æ•¸
const termsSections = messages.legal?.terms || {};
const expectedParagraphs = Object.values(termsSections).reduce((total, section) => {
  return total + (Array.isArray(section) ? section.length : 0);
}, 0);
console.info("[legal-check] terms paragraphs:", {expected: expectedParagraphs, sections: Object.keys(termsSections).length});

// å“ç‰ŒåŒ–æ ‡é¢˜
const termsTitle = brandify(messages.legal?.termsTitle || messages.footer?.terms || 'moonpacket ä½¿ç”¨è€…æ¢æ¬¾ï¼ˆTerms of Serviceï¼‰');
const privacyTitle = brandify(messages.legal?.privacyTitle || messages.footer?.privacy || 'moonpacket éš±ç§æ¬Šæ¢æ¬¾ï¼ˆPrivacy Policyï¼‰');
const termsPageTitle = messages.legal?.termsTitle || messages.footer?.terms || 'moonpacket ä½¿ç”¨è€…æ¢æ¬¾ï¼ˆTerms of Serviceï¼‰';

// å“ç‰ŒåŒ–heroæ–‡æœ¬ï¼ˆç”¨äºset:htmlï¼Œä¸ç”¨äºç»„ä»¶å±æ€§ï¼‰
const heroTitleRaw = messages.site?.hero?.title || '';
const heroTitleHTML = brandify(heroTitleRaw);
const ctaPrimaryLabelRaw = messages.site?.hero?.ctaPrimaryLabel || '';

const canonical = computeCanonical(Astro.url, (Astro.site && Astro.site.toString()) || undefined);

// ç‰©ä»¶/å­—ä¸²/é™£åˆ— çš†è½‰ç‚ºå­—ä¸²é™£åˆ—ï¼ˆæ”¯æ´ CSV å°å‡º {"0":"..."} çµæ§‹ï¼‰
function toLines(value: any): string[] {
  try {
    if (!value) return [];
    if (Array.isArray(value)) return value.filter(Boolean).map(String);
    if (typeof value === 'string') return value.replace(/\\n/g,'\n').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    if (typeof value === 'object') return Object.keys(value).sort((a,b)=>Number(a)-Number(b)).map(k=>String(value[k])).filter(Boolean);
    return [];
  } catch { return []; }
}
---
<BaseLayout lang={lang} title={termsPageTitle} description={messages.site?.description || ''} canonicalUrl={canonical} allLocales={LOCALE_ORDER}>
  <main id="main-content">
    <section id="hero" class="relative mx-auto max-w-6xl px-4 py-6 overflow-visible">
      <div class="pointer-events-none absolute inset-0 z-[5]">
        <astro-island>
          <RedPacketAnimation client:visible />
        </astro-island>
      </div>
      <div class="relative z-10 grid grid-cols-1 md:grid-cols-5 gap-6 items-center">
        <div class="md:col-span-4">
          <HeroTextAnimated
            title={messages.site?.hero?.title || ''}
            subtitle={messages.site?.hero?.subtitle || ''}
            withBackground={false}
            ctaPrimaryLabel={messages.site?.hero?.ctaPrimaryLabel || ''}
            ctaPrimaryHref={CTA_LINKS.mainBot}
            ctaSecondaryLabel={messages.site?.hero?.ctaSecondaryLabel || ''}
            ctaSecondaryHref={`/${lang}/send/#about-send`}
          />
        </div>
        <div class="hidden md:block md:col-span-1"></div>
      </div>
    </section>

    <div id="about-terms"></div>
    <Section class="py-10">
      <h2 class="text-xl font-semibold" set:html={termsTitle}></h2>
      <div class="grid grid-cols-1 gap-4">
        <!-- Legal Disclaimer (non-en-US only: zh-TW and future languages) -->
        {(lang !== 'en-US' && messages.legal?.terms?.notice?.disclaimer_binding) && (
          <div class="mb-4 max-w-screen-lg w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-[13px] leading-relaxed text-textSubtle flex flex-row flex-wrap items-start">
            <span class="inline-flex items-center justify-center rounded-full bg-[#ff6a00] px-2 py-0.5 text-[10px] font-semibold leading-none text-black mr-2">Legal</span>
            <p class="flex-1">{messages.legal.terms.notice.disclaimer_binding}</p>
          </div>
        )}
        <div class="rounded-xl bg-white shadow-sm ring-1 ring-black/5 p-5">
          <div class="text-base text-textSubtle leading-relaxed space-y-5 legal-prose">
            <p><strong>{messages.legal?.terms?.version_label || 'ç‰ˆæœ¬'}</strong>: {(messages.terms && messages.terms.version) || 'v1.0.0'}ã€€<strong>{messages.legal?.terms?.updated_label || 'æ›´æ–°'}</strong>: {(messages.terms && messages.terms.updated) || '2025-10-05'}ã€€<strong>{messages.legal?.terms?.owner_label || 'Owner'}</strong>: <Brandify text={(messages.terms && messages.terms.owner) || 'moonpacket-core'} /></p>
            <blockquote class="border-l-2 pl-3"><Brandify text={messages.legal?.terms?.intro?.[0] || 'æœ¬ä½¿ç”¨è€…æ¢æ¬¾ï¼ˆä»¥ä¸‹ç¨±ã€Œæœ¬æ¢æ¬¾ã€ï¼‰ä¿‚æ‚¨ï¼ˆä»¥ä¸‹ç¨±ã€Œæ‚¨ã€æˆ–ã€Œä½¿ç”¨è€…ã€ï¼‰èˆ‡ <strong>moonpacket</strong>ï¼ˆä»¥ä¸‹ç¨±ã€Œæˆ‘å€‘ã€æˆ–ã€Œæœ¬å…¬å¸ã€ï¼‰ä¹‹é–“ï¼Œå°±æ‚¨ä½¿ç”¨ moonpacket æ‰€æä¾›ä¹‹ Telegram Mini Appã€æ©Ÿå™¨äººï¼ˆBotï¼‰åŠç¶²ç«™ç­‰æœå‹™ï¼ˆä»¥ä¸‹åˆç¨±ã€Œæœ¬æœå‹™ã€ï¼‰æ‰€è¨‚ç«‹ã€‚è«‹åœ¨ä½¿ç”¨å‰è©³è®€ï¼›æ‚¨é–‹å§‹ä½¿ç”¨å³è¦–ç‚ºåŒæ„å—æœ¬æ¢æ¬¾æ‹˜æŸã€‚'} /></blockquote>

            <h3 class="text-base font-semibold">1) {messages.legal?.sections?.scope || 'é©ç”¨ç¯„åœèˆ‡å¥‘ç´„æˆç«‹'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.intro).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">2) {messages.legal?.sections?.definitions || 'å®šç¾©'}</h3>
            <ul class="list-disc pl-5">
              {toLines(messages.legal?.terms?.definitions).map(item => <li set:html={brandify(item)} />)}
            </ul>

            <h3 class="text-base font-semibold">3) {messages.legal?.sections?.eligibility || 'è³‡æ ¼èˆ‡å¸³è™Ÿ'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.eligibility).map(item => <li set:html={brandify(item)} />)}
              {toLines(messages.legal?.terms?.accounts).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">4) {messages.legal?.sections?.services || 'æœå‹™å…§å®¹'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.service).map(item => <li set:html={brandify(item)} />)}
              {toLines(messages.legal?.terms?.features).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">5) {messages.legal?.sections?.wallet || 'é›²ç«¯éŒ¢åŒ…èˆ‡è³‡é‡‘'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.cloudWallet).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">6) {messages.legal?.sections?.fees || 'æ‰‹çºŒè²»èˆ‡è¨ˆè²»'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.fees).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">7) {messages.legal?.sections?.rules || 'æ´»å‹•è¦å‰‡èˆ‡å…¬å¹³'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.rules).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">8) {messages.legal?.sections?.restrictions || 'é˜²åˆ·èˆ‡ä½¿ç”¨é™åˆ¶'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.abuse).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">9) {messages.legal?.sections?.ip || 'å…§å®¹èˆ‡æ™ºæ…§è²¡ç”¢æ¬Š'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.ip).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">10) {messages.legal?.sections?.third_party || 'ç¬¬ä¸‰æ–¹æœå‹™'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.thirdparty).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">11) {messages.legal?.sections?.data || 'è³‡æ–™èˆ‡éš±ç§'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.dataPrivacy).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">12) {messages.legal?.sections?.risks || 'é¢¨éšªæ­éœ²'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.risk).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">13) {messages.legal?.sections?.disclaimer || 'å…è²¬è²æ˜'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.disclaimer).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">14) {messages.legal?.sections?.liability || 'è²¬ä»»é™åˆ¶'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.liability).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">15) {messages.legal?.sections?.indemnity || 'è³ å„Ÿ'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.indemnity).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">16) {messages.legal?.sections?.termination || 'æš«åœã€çµ‚æ­¢èˆ‡åˆªé™¤'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.suspension).map(item => <li set:html={brandify(item)} />)}
              {toLines(messages.legal?.terms?.compliance).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">17) {messages.legal?.sections?.force_majeure || 'ä¸å¯æŠ—åŠ›'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.forceMajeure).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">18) {messages.legal?.sections?.high_risk || 'é«˜é¢¨éšªç”¨é€”ç¦æ­¢'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.highRisk).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">19) {messages.legal?.sections?.tax || 'ç¨…å‹™èˆ‡ç”³å ±'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.tax).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">20) {messages.legal?.sections?.accuracy || 'å…§å®¹èˆ‡è³‡æ–™æ­£ç¢ºæ€§'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.accuracy).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">21) {messages.legal?.sections?.governing_law || 'æº–æ“šæ³•èˆ‡çˆ­è­°è™•ç†'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.law).map(item => <li set:html={brandify(item)} />)}
              {toLines(messages.legal?.terms?.disputes).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">22) {messages.legal?.sections?.contact || 'è¯çµ¡æ–¹å¼'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.contact).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">23) {messages.legal?.sections?.changes || 'æ¢æ¬¾è®Šæ›´'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.changes).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">24) {messages.legal?.terms?.serviceChanges?.title || 'æœå‹™èª¿æ•´èˆ‡æ¢æ¬¾æ›´æ–°'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.serviceChanges?.body).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">25) {messages.legal?.terms?.userContent?.title || 'ä½¿ç”¨è€…å…§å®¹èˆ‡å…¬é–‹å±•ç¤ºæˆæ¬Š'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.userContent?.body).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">26) {messages.legal?.terms?.liabilityCap?.title || 'è²¬ä»»é™åˆ¶èˆ‡è³ å„Ÿä¸Šé™'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.liabilityCap?.body).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">27) {messages.legal?.terms?.governingLaw?.title || 'é©ç”¨æ³•å¾‹èˆ‡çˆ­è­°è§£æ±º'}</h3>
            <ol class="list-decimal pl-5 space-y-1">
              {toLines(messages.legal?.terms?.governingLaw?.body).map(item => <li set:html={brandify(item)} />)}
            </ol>

            <h3 class="text-base font-semibold">{messages.legal?.terms?.appendix_title || 'é™„éŒ„ï½œå®šç¾©èˆ‡è§£é‡‹'}</h3>
            <ul class="list-disc pl-5">
              {toLines(messages.legal?.terms?.appendix).map(item => <li set:html={brandify(item)} />)}
            </ul>
          </div>
        </div>
      </div>
    </Section>
  </main>
</BaseLayout>
